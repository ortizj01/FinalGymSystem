<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Gym System | Nueva Contraseña</title>
    {{> header}}
    <!-- Agrega los iconos de Font Awesome para el ojito -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  </head>
  <body class=" " data-bs-spy="scroll" data-bs-target="#elements-section" data-bs-offset="0" tabindex="0">
    <!-- loader Start -->
    <div id="loading">
      <div class="loader simple-loader">
        <div class="loader-body">
        </div>
      </div>    
    </div>
    <!-- loader END -->
    
    <div class="wrapper">
      <section class="login-content">
        <div class="row m-0 align-items-center bg-white vh-100">
          <div class="col-md-6 d-md-block d-none bg-primary p-0 mt-n1 vh-100 overflow-hidden">
            <img src="../../assets/images/auth/03.jpg" class="img-fluid gradient-main animated-scaleX" alt="images">
          </div>
          <div class="col-md-6 p-0">               
            <div class="card card-transparent auth-card shadow-none d-flex justify-content-center mb-0">
              <div class="card-body">
                <a href="/indexCarrito" class="navbar-brand d-flex align-items-center mb-3">
                  <!--Logo start-->
                  <div class="logo-main">
                    <div class="logo-normal">
                      <svg class=" icon-30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.4 7H4.6C4.26863 7 4 7.26863 4 7.6V16.4C4 16.7314 4.26863 17 4.6 17H7.4C7.73137 17 8 16.7314 8 16.4V7.6C8 7.26863 7.73137 7 7.4 7Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19.4 7H16.6C16.2686 7 16 7.26863 16 7.6V16.4C16 16.7314 16.2686 17 16.6 17H19.4C19.7314 17 20 16.7314 20 16.4V7.6C20 7.26863 19.7314 7 19.4 7Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 14.4V9.6C1 9.26863 1.26863 9 1.6 9H3.4C3.73137 9 4 9.26863 4 9.6V14.4C4 14.7314 3.73137 15 3.4 15H1.6C1.26863 15 1 14.7314 1 14.4Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M23 14.4V9.6C23 9.26863 22.7314 9 22.4 9H20.6C20.2686 9 20 9.26863 20 9.6V14.4C20 14.7314 20.2686 15 20.6 15H22.4C22.7314 15 23 14.7314 23 14.4Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 12H16" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="logo-mini">
                      <svg class=" icon-30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.4 7H4.6C4.26863 7 4 7.26863 4 7.6V16.4C4 16.7314 4.26863 17 4.6 17H7.4C7.73137 17 8 16.7314 8 16.4V7.6C8 7.26863 7.73137 7 7.4 7Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19.4 7H16.6C16.2686 7 16 7.26863 16 7.6V16.4C16 16.7314 16.2686 17 16.6 17H19.4C19.7314 17 20 16.7314 20 16.4V7.6C20 7.26863 19.7314 7 19.4 7Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 14.4V9.6C1 9.26863 1.26863 9 1.6 9H3.4C3.73137 9 4 9.26863 4 9.6V14.4C4 14.7314 3.73137 15 3.4 15H1.6C1.26863 15 1 14.7314 1 14.4Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M23 14.4V9.6C23 9.26863 22.7314 9 22.4 9H20.6C20.2686 9 20 9.26863 20 9.6V14.4C20 14.7314 20.2686 15 20.6 15H22.4C22.7314 15 23 14.7314 23 14.4Z" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 12H16" stroke="#FF5733" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                  <!--logo End-->
                  <div class="logo-main">
                    <div class="logo-normal">
                      <!-- SVG Logo code -->
                    </div>
                    <h4 class="logo-title ms-3">Gym System</h4>
                  </div>
                </a>
                <br><br>
                <p>Ingresa tu nueva contraseña</p>
                <form id="new-password-form">
                  <div class="row">
                    <div class="form-group">
                      <label for="pw-nueva">Contraseña nueva:</label>
                      <div class="input-group">
                        <input type="password" class="form-control" id="pw-nueva" value="">
                        <span class="input-group-text">
                          <i class="fas fa-eye" id="togglePwNueva" style="cursor: pointer;"></i>
                        </span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="pw-confirma">Confirmar Contraseña:</label>
                      <div class="input-group">
                        <input type="password" class="form-control" id="pw-confirma" value="">
                        <span class="input-group-text">
                          <i class="fas fa-eye" id="togglePwConfirma" style="cursor: pointer;"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-primary">Confirmar</button>
                  <a href="/ingresar" class="btn btn-dark">Cancelar</a>
                </form>
              </div>
            </div>               
          </div>
        </div>
      </section>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Toggle visibility for password fields
        const togglePwNueva = document.getElementById('togglePwNueva');
        const togglePwConfirma = document.getElementById('togglePwConfirma');
        const pwNueva = document.getElementById('pw-nueva');
        const pwConfirma = document.getElementById('pw-confirma');

        togglePwNueva.addEventListener('click', function () {
          const type = pwNueva.getAttribute('type') === 'password' ? 'text' : 'password';
          pwNueva.setAttribute('type', type);
          this.classList.toggle('fa-eye-slash');
        });

        togglePwConfirma.addEventListener('click', function () {
          const type = pwConfirma.getAttribute('type') === 'password' ? 'text' : 'password';
          pwConfirma.setAttribute('type', type);
          this.classList.toggle('fa-eye-slash');
        });

        // Handle form submission
        document.getElementById('new-password-form').addEventListener('submit', async (event) => {
          event.preventDefault();

          const password = pwNueva.value;
          const confirmPassword = pwConfirma.value;
          
          // Extraer el token de los parámetros de consulta
          const urlParams = new URLSearchParams(window.location.search);
          const token = urlParams.get('token');
          
          if (password !== confirmPassword) {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Las contraseñas no coinciden'
            });
            return;
          }

          try {
            const response = await fetch(`https://finalgymsystem.onrender.com/api/auth/resetPassword/${token}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ password })
            });

            const result = await response.json();
            if (response.ok) {
              Swal.fire({
                icon: 'success',
                title: 'Éxito',
                text: result.msg,
              }).then(() => {
                window.location.href = '/ingresar';
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: result.msg
              });
            }
          } catch (error) {
            console.error('Error:', error);
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Ocurrió un error. Por favor, intenta nuevamente.'
            });
          }
        });
      });
    </script>

    {{> footer}}
  </body>
</html>
